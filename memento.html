<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Memento – Yu Zeng Photography</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Playfair+Display:ital,wght@1,500&display=swap" rel="stylesheet">

<style>
*{ box-sizing:border-box; }

html, body{ height:100%; }

body{
  margin:0;
  font-family: Arial, sans-serif;
  background:#e9edf2;
  color:#111;
}

/* ✅ Strong scroll lock (prevents Chrome scroll-through / chaining) */
body.lb-open{
  position: fixed;
  left: 0;
  right: 0;
  width: 100%;
  overflow: hidden;
  overscroll-behavior: none;
}

/* ===== Navbar ===== */
.navbar{
  position:fixed;
  top:0; left:0; right:0;
  height:72px;
  background:rgba(10,20,35,0.94);
  backdrop-filter:blur(8px);
  -webkit-backdrop-filter:blur(8px);
  z-index:2000;
}

/* Lightbox opened: disable blur to reduce repaint cost */
body.lb-open .navbar{
  backdrop-filter:none !important;
  -webkit-backdrop-filter:none !important;
}

.nav-inner{
  max-width:1200px;
  height:100%;
  margin:0 auto;
  padding:0 28px;
  display:flex;
  align-items:center;
  justify-content:space-between;
}

/* ===== Brand ===== */
.brand{
  display:flex;
  align-items:center;
  gap:14px;
  text-decoration:none;
}
.brand-logo{ height:48px; width:auto; }

.brand-text{ display:flex; flex-direction:column; line-height:1; }
.brand-name{
  font-family:"Montserrat",sans-serif;
  font-weight:700;
  font-size:17px;
  letter-spacing:1.6px;
  color:#fff;
}
.brand-sub{
  margin-top:4px;
  font-family:"Playfair Display",serif;
  font-style:italic;
  font-size:14px;
  color:rgba(255,255,255,0.8);
}

/* ===== Nav links ===== */
.nav-links{ display:flex; gap:34px; align-items:center; }
.nav-links a{
  color:rgba(255,255,255,0.85);
  text-decoration:none;
  font-size:16px;
  padding:6px 0;
  border-bottom:2px solid transparent;
  white-space:nowrap;
}
.nav-links a:hover{ color:#fff; }
.nav-links a.active{ color:#fff; border-bottom-color:#fff; }

/* ===== Hero ===== */
.hero{
  margin-top:72px;
  padding:110px 0 80px;
  text-align:center;
  color:#fff;
  background:
    linear-gradient(rgba(0,0,0,0.45),rgba(0,0,0,0.45)),
    url("photo_x/E_x.jpg") center/cover no-repeat;
}
.hero h1{ margin:0 0 10px; font-size:56px; }
.hero p{ margin:0; font-size:18px; opacity:.9; }

/* ===== Page container ===== */
main.page{
  max-width: 1100px;
  margin: 0 auto;
  padding: 28px 20px 80px;
}

/* ===== Masonry (album covers) ===== */
.masonry{
  column-count: 3;
  column-gap: 16px;
}
@media (max-width: 950px){ .masonry{ column-count: 2; } }
@media (max-width: 650px){ .masonry{ column-count: 1; } }

.album{
  break-inside: avoid;
  margin-bottom: 16px;
  cursor: pointer;
}

.album img{
  width: 100%;
  display:block;
  border-radius: 12px;
  box-shadow: 0 10px 22px rgba(0,0,0,0.10);
  transition: transform .18s ease, box-shadow .18s ease;
}
.album:hover img{
  transform: translateY(-2px);
  box-shadow: 0 14px 30px rgba(0,0,0,0.14);
}
.album p{
  margin: 8px 0 0;
  text-align:center;
  font-size: 14px;
  color:#444;
}

/* ===== Lightbox ===== */
.lightbox{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.86);
  display: none;
  flex-direction: column;
  z-index: 3000;

  /* Desktop: allow scroll if caption is long */
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;

  /* ✅ prevent scroll chaining */
  overscroll-behavior: contain;
}
.lightbox.open{ display:flex; }

/* stage (desktop + base) */
.lightbox .lb-stage{
  min-height: auto;
  display:flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding-left: 16px;
  padding-right: 16px;
  padding-top: 70px;   /* keep away from close btn */
  padding-bottom: 22px;
}

.lightbox img{
  width: auto;
  max-width: 92vw;
  max-height: 80vh;
  border-radius: 12px;
  box-shadow: 0 18px 40px rgba(0,0,0,0.35);
  display:block;
  object-fit: contain;
}

/* Smooth swap */
#lb-img{
  opacity: 0;
  transition: opacity .18s ease;
  will-change: opacity;
  -webkit-user-select: none;
  user-select: none;
  -webkit-touch-callout: none;
}
.lightbox.open #lb-img{ opacity: 1; }

/* Desktop caption (below image, scroll with page) */
.lightbox .caption{
  color: #fff;
  margin-top: 12px;
  text-align: center;
  max-width: 920px;
  line-height: 1.55;
  font-size: 15px;
  opacity: 0.95;
  padding: 0 10px 18px;
  white-space: pre-line;
  word-break: break-word;
}

/* Buttons */
.lb-close, .lb-prev, .lb-next{
  position: absolute;
  background: rgba(255,255,255,0.12);
  border: 1px solid rgba(255,255,255,0.25);
  color: #fff;
  width: 44px;
  height: 44px;
  border-radius: 999px;
  font-size: 26px;
  line-height: 40px;
  cursor: pointer;
  user-select: none;
}

.lb-close{
  position: fixed;
  top: 18px;
  right: 22px;
  z-index: 5000;
  font-size: 30px;
  line-height: 38px;
  background: rgba(0,0,0,0.55);
  border-color: rgba(255,255,255,0.22);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  pointer-events: auto;
}

.lb-prev{ left: 18px; top: 50%; transform: translateY(-50%); }
.lb-next{ right: 18px; top: 50%; transform: translateY(-50%); }

.lb-prev[disabled], .lb-next[disabled]{
  opacity: .45;
  cursor: not-allowed;
}

/* Mobile caption sheet (desktop off) */
.caption-sheet{ display:none; }

/* ===== Mobile nav behavior ===== */
@media (max-width:700px){
  .navbar{ height:64px; }
  .nav-inner{ padding:0 18px; }
  .brand-logo{ height:28px; }

  .nav-links{
    gap:16px;
    overflow-x:auto;
    max-width:70vw;
    scrollbar-width:none;
    flex-wrap: nowrap;
  }
  .nav-links::-webkit-scrollbar{ display:none; }
  .nav-links a{ font-size:13px; }

  .hero{ margin-top:64px; padding:90px 0 60px; }
  .hero h1{ font-size:40px; }
  .hero p{ font-size:16px; }

  .lightbox{
    overflow: hidden; /* mobile page不滚动，caption在sheet里滚 */
    touch-action: pan-y;
  }

  .lightbox .lb-stage{
    min-height: 100dvh;
    padding-top: calc(env(safe-area-inset-top, 0px) + 64px);
    padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 18px);
    justify-content: center;
  }

  .lightbox img{
    max-height: 78dvh;
    max-width: 92vw;
  }

  /* Hide desktop caption on mobile */
  .lightbox .caption{ display:none; }

  /* Mobile arrows fixed to viewport */
  .lb-prev, .lb-next{
    position: fixed;
    top: 50%;
    transform: translateY(-50%);
    z-index: 3600;
    transition: top .18s ease;
  }
  .lb-prev{ left: 12px; }
  .lb-next{ right: 12px; }

  /* When caption sheet opens, lift arrows upward */
  .lightbox.cap-open .lb-prev,
  .lightbox.cap-open .lb-next{
    top: calc(50% - 90px);
  }

  /* Close button safe area (永远可见) */
  .lb-close{
    position: fixed !important;
    top: calc(env(safe-area-inset-top, 0px) + 12px);
    right: calc(env(safe-area-inset-right, 0px) + 12px);
    z-index: 5000;
    pointer-events: auto;
  }

  /* Mobile bottom sheet */
  .caption-sheet{
    display:block;
    position: fixed;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 3500;

    max-height: 72dvh;

    background: rgba(0,0,0,0.70);
    border-top: 1px solid rgba(255,255,255,0.16);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);

    transform: translateY(calc(100% - 74px));
    transition: transform .22s ease;
    will-change: transform;

    display:flex;
    flex-direction: column;

    padding-bottom: env(safe-area-inset-bottom, 0px);
  }

  .lightbox.cap-open .caption-sheet{
    transform: translateY(0);
  }

  .cap-handle{
    height: 74px;
    padding: 10px 14px 8px;
    display:flex;
    flex-direction: column;
    justify-content: center;
    gap: 8px;
    user-select:none;
    -webkit-user-select:none;
  }
  .cap-grip{
    width: 46px;
    height: 4px;
    border-radius: 999px;
    background: rgba(255,255,255,0.35);
    margin: 0 auto;
  }
  .cap-title{
    color:#fff;
    font-size: 13px;
    opacity: .90;
    text-align:center;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .cap-body{
    padding: 0 16px 16px;
    overflow: auto;
    -webkit-overflow-scrolling: touch;
    color:#fff;
    opacity: .95;
    line-height: 1.55;
    font-size: 14px;
    white-space: pre-line;
  }
}

/* =========================
   ✅ Desktop scroll hint (NEW)
   ========================= */
.lb-scroll-hint{
  position: fixed;
  left: 50%;
  transform: translateX(-50%);
  bottom: 18px;

  padding: 8px 14px;
  border-radius: 999px;
  background: rgba(0,0,0,0.55);
  border: 1px solid rgba(255,255,255,0.18);
  color: rgba(255,255,255,0.92);
  font-size: 13px;
  line-height: 1;
  z-index: 5200;

  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);

  display: none;
  pointer-events: none;
}
.lb-scroll-hint.show{ display: inline-flex; }

/* Mobile: hide hint */
@media (max-width:700px){
  .lb-scroll-hint{ display:none !important; }
}
</style>
</head>

<body>

<nav class="navbar">
  <div class="nav-inner">
    <a class="brand" href="index.html">
      <img src="photo_x/Logo.png" alt="Yu Zeng logo" class="brand-logo">
      <div class="brand-text">
        <span class="brand-name">Yu Zeng</span>
        <span class="brand-sub">Photography</span>
      </div>
    </a>

    <div class="nav-links">
      <a href="index.html">Home</a>
      <a class="active" href="memento.html">Memento</a>
      <a href="shutter.html">Shutter</a>
      <a href="sport.html">Sport</a>
      <a href="contact.html">Contact</a>
    </div>
  </div>
</nav>

<header class="hero">
  <h1>Memento</h1>
  <p>Places, people, and moments that shaped my memory.</p>
</header>

<main class="page">
  <div class="masonry">

    
    <div class="album"
      data-title="Liverpool"
      data-caption='Liverpool is a place full of memories.
The city is gloomy and unapologetically devoted to its drinking culture.
I met many people, and along the way, with two truly amazing Chinese friends who made Liverpool feel like home.
We made it to a million bars, hit my head in the climbing gym with Olivia, fell off the wall, and asked Chengwang to take care of me,
stayed at Finn&apos;s place watching dramas, outdoor bouldering with Martijn...
The cover photo was a walk with my “bro” Xin on a "strange" beautiful day.'
      data-images="photo_x/DSC00741_x.jpg,photo_x/DSC01866_x.jpg,photo_x/DSC00395_x.jpg,photo_x/DSC01801_x.jpg,photo_x/DSC00721_x.jpg,photo_x/DSC00197_x.jpg,photo_x/DSC00605_x.jpg">
      <img src="photo_x/DSC00741_x.jpg" alt="Liverpool cover" loading="lazy" decoding="async">
      <p>Liverpool</p>
    </div>


 <div class="album"
  data-title="Tibet"
  data-caption="The Tibetan Plateau has always been a dream place for me. I was fortunate enough to visit in late autumn, 2025. High altitude is not something I handle well. Long walks with less than a thousand meters of ascent almost broke me, but they never diminished the fantastic views. The locals were hospitable and warm, always willing to communicate despite the huuuge language barrier between us.
  The last day, I was enjoying the coffee (with a pile of poop), watching the sunset hitting the Yala peak was something I can never forget.
   
I have always loved the quote, 'The mountain is always there.' Somehow, it perfectly defines this trip."
  data-images="photo_x/DSC07427_x.jpg,photo_x/DSC07366_x.jpg,photo_x/DSC06613_x.jpg,photo_x/DSC06692_x.jpg,photo_x/DSC06816_x.jpg,photo_x/DSC06931_x.jpg,photo_x/DSC06980_x.jpg,photo_x/DSC07112_x.jpg,photo_x/DSC07244_x.jpg,photo_x/DSC07292_x.jpg,photo_x/DSC07317_x.jpg,photo_x/DSC07393_x.jpg,photo_x/DSC07424_x.jpg">
  
  <img src="photo_x/DSC07427_x.jpg" alt="Tibet cover" loading="lazy" decoding="async">
  <p>Tibet, China. 2025</p>
</div>

    
<div class="album"
  data-title="Huangshan"
  data-caption="Astonishing views. I was fascinated by the strange stone known as 'Monkey Watching the Ocean.' (cover). Camping alone in my small tent, with no one else around, was both quiet and unforgettable."
  data-images="photo_x/DSC03702_x.jpg,photo_x/DSC03589_x.jpg,photo_x/DSC03638_x.jpg,photo_x/DSC03645_x.jpg,photo_x/DSC03678_x.jpg,photo_x/DSC03696_x.jpg,photo_x/DSC03729_x.jpg,photo_x/DSC03735_x.jpg">

  <img src="photo_x/DSC03702_x.jpg" alt="Huangshan cover" loading="lazy" decoding="async">
  <p>Huangshan，China</p>
</div>

    <div class="album"
  data-title="Days in Bozel"
  data-caption="Living in a dangerous man's house sounds like a perfect beginning for a horror movie.
     
  Mornings were always beautiful and quiet, with balcony views that felt almost unreal (cover).
  He made me feel at home, built the fire pit, brought me to take photos, cooked incredible food, and shared quiet music — too quiet.
  One night, he took me to an Irish pub that reminded me of our first trip, and I could feel time tightening.
  Everything was blurred until he brought me into the woods, deep into thick snow, where he hid his shotgun. I can smell the Japanese blood in his veines.
  I stayed in the car and took a photo while he stood there, delighted with his giant rock. The car was stuck in the snow.
  I wanted so badly to outplay him, to trick him just like he tricked me, but I failed. I lost the “chess” game last night.
     
  But somehow, I ran away. It felt like waking up from a dream — disoriented, unreal.
  I felt extremely sad leaving, even knowing why I had to.
  It felt like Stockholm syndrome: wanting to go back to him once — or maybe twice, or several times."
  data-images="
    photo_x/DSC07490_x.jpg,
    photo_x/DSC07528_x.jpg,
    photo_x/DSC07574_x.jpg,
    photo_x/DSC07546_x.jpg,
    photo_x/DSC07518_x.jpg,
    photo_x/DSC07463_x.jpg,
    photo_x/DSC07568_x.jpg
  ">
  <img src="photo_x/DSC07490_x.jpg" alt="Days in Bozel" loading="lazy" decoding="async">
  <p>Days in Bozel</p>
</div>

  <div class="album"
  data-title="Pancake, ice cream, maple syrup, and fresh milk"
  data-caption="Quebec, 2024.
    
  Pancake — Pierre: ‘Is there one thing you want to try but haven’t tried here?’ Me: Pancake. Then I got the dough from him :)
  Ice cream — The first time I saw how ice cream is made.
  Maple syrup — Went to the prince’s mansion and ate crêpes on a huge 'petite terrasse'.
  Fresh milk — A glimpse of America: a little walk, a local farm, free fresh milk, and fireflies."
  data-images="photo_x/DSC02851_x.jpg,photo_x/DSC02890_x.jpg,photo_x/DSC02651_x.jpg,photo_x/DSC02559_x.jpg,photo_x/DSC02486_x.jpg">

  <img src="photo_x/DSC02851_x.jpg" alt="Quebec food memories cover" loading="lazy" decoding="async">
  <p>Pancake, ice cream, maple syrup, and fresh milk</p>
</div>

<div class="album"
  data-title="Suzhou"
  data-caption="A city I lived in for nearly five years. It is a twisted place, rich in history, yet overdeveloped (I prefer the old towns). Known as 'the Garden of the Emperor,' the city is threaded with canals and full of carefully kept gardens.

I am glad I left in the end; it was the darkest period of my life. And yet, I always miss the friends I made there. Shuai has asked me to go back for spring hikes, climbing in his gym, and cooking at his place."
  data-images="photo_x/DSC02362_x.jpg,photo_x/DSC02356_x.jpg,photo_x/DSC02352_x.jpg,photo_x/DSC02366_x.jpg,photo_x/DSC02368_x.jpg,photo_x/DSC02369_x.jpg,photo_x/DSC02371_x.jpg,photo_x/DSC02372_x.jpg, photo_x/DSC02302_x.jpg,photo_x/DSC02312_x.jpg">

  <img src="photo_x/DSC02362_x.jpg" alt="Suzhou cover" loading="lazy" decoding="async">
  <p>Suzhou</p>
</div>

    <div class="album"
      data-title="Great adventure with the prince in Northern Ireland."
      data-caption="A conference for me is boring (sometimes). I start the talk, since I hate being awkward. I never thought I would have the adventure and met a friend. "
      data-images="photo_x/IMG_7043.JPEG">
      <img src="photo_x/IMG_7043.JPEG" alt="Northern Ireland cover" loading="lazy" decoding="async">
      <p>Great adventure with the prince in Northern Ireland</p>
 </div>

</div>

 <div class="album"
  data-title="Wales."
  data-caption="Five times in Wales already spoken for itself. Beaches, mountains, good people...<br><br>
  1. Never made it to the top of Snowdon with Chengwang, and it is on my death list.<br>
  2. Pascla: 'How much do you think it would cost to go down?' Me: '15?' P: '20, want a bet?' M: 'Sure, but would be cool if it is free'. 
  We asked, and it only serve going up and down at the same time, so they gave us the free ride :)<br>
  3. Release anemone, watch football, camping, drunk and lost the pillow."
  data-images="
    photo_x/DSC00826_x.jpg,
    photo_x/DSC00845_x.jpg,
    photo_x/DSC00849_x.jpg,
    photo_x/DSC00859_x.jpg,
    photo_x/DSC00866_x.jpg,
    photo_x/DSC00938_x.jpg,
    photo_x/DSC01535_x.jpg,
    photo_x/DSC01660_x.jpg,
    photo_x/DSC02037_x.jpg,
    photo_x/DSC02146_x.jpg,
    photo_x/DSC02166_x.jpg,
    photo_x/DSC02171_x.jpg
  ">
  <img src="photo_x/DSC02037_x.jpg" alt="Wales cover" loading="lazy" decoding="async">
  <p>Wales</p>
</div>


    
  </div>

  <div id="lightbox" class="lightbox" aria-hidden="true">
    <button class="lb-close" aria-label="Close">&times;</button>
    <button class="lb-prev" aria-label="Previous">&#8249;</button>

    <div class="lb-stage">
      <img id="lb-img" src="" alt="" decoding="async" draggable="false">
      <div class="caption" id="lb-caption"></div>
    </div>

    <button class="lb-next" aria-label="Next">&#8250;</button>

    <div class="caption-sheet" id="capSheet" aria-hidden="true">
      <div class="cap-handle" id="capHandle">
        <div class="cap-grip"></div>
        <div class="cap-title" id="capTitle">Swipe up for caption</div>
      </div>
      <div class="cap-body" id="capBody"></div>
    </div>

    <!-- ✅ Desktop scroll hint (NEW) -->
    <div class="lb-scroll-hint" id="lbScrollHint" aria-hidden="true">
      Scroll for more ↓
    </div>
  </div>
</main>

<script>
  const lb = document.getElementById('lightbox');
  const lbImg = document.getElementById('lb-img');
  const lbCaption = document.getElementById('lb-caption');
  const btnClose = document.querySelector('.lb-close');
  const btnPrev = document.querySelector('.lb-prev');
  const btnNext = document.querySelector('.lb-next');

  const capSheet = document.getElementById('capSheet');
  const capHandle = document.getElementById('capHandle');
  const capTitle = document.getElementById('capTitle');
  const capBody = document.getElementById('capBody');

  // ✅ Desktop hint element (NEW)
  const lbScrollHint = document.getElementById('lbScrollHint');

  let images = [];
  let index = 0;
  let title = '';
  let caption = '';

  let isSwitching = false;
  let unlockTimer = null;

  // ✅ scroll-lock state (fixes Chrome main-page scrolling)
  let scrollY = 0;

  function isMobileNow(){
    return window.matchMedia("(max-width:700px)").matches;
  }

  function preload(src){
    if(!src) return;
    const im = new Image();
    im.decoding = "async";
    im.src = src;
  }

  function safeIndex(i){
    if(!images.length) return 0;
    return (i + images.length) % images.length;
  }

  function setNavDisabled(disabled){
    btnPrev.disabled = disabled;
    btnNext.disabled = disabled;
  }

  function lockIfMobile(){
    if(!isMobileNow()) return;

    isSwitching = true;
    setNavDisabled(true);

    if(unlockTimer) clearTimeout(unlockTimer);
    unlockTimer = setTimeout(() => {
      isSwitching = false;
      setNavDisabled(false);
      unlockTimer = null;
    }, 500);
  }

  function unlock(){
    if(unlockTimer){
      clearTimeout(unlockTimer);
      unlockTimer = null;
    }
    isSwitching = false;
    setNavDisabled(false);
  }

  function closeCaptionSheet(){
    lb.classList.remove('cap-open');
    if(capSheet) capSheet.setAttribute('aria-hidden','true');
  }

  function openCaptionSheet(){
    lb.classList.add('cap-open');
    if(capSheet) capSheet.setAttribute('aria-hidden','false');
  }

  // ✅ remove only the duplicate prefix at the START of body (keep top title line)
  function escapeRegExp(s){
    return String(s).replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
  }
  function stripDupPrefixFromBody(rawBody, t, counter){
    let body = (rawBody || "").trim();
    if(!body) return "";

    const tt = (t || "").trim();
    if(!tt) return body;

    const T = escapeRegExp(tt);
    const C = escapeRegExp(counter);

    // Allow: "Liverpool — 1/7", "Liverpool-1/7", "Liverpool 1/7" at start
    const re1 = new RegExp("^\\s*" + T + "\\s*[—–-]\\s*" + C + "\\s*(?:[·•\\-–—]\\s*)?", "i");
    const re2 = new RegExp("^\\s*" + T + "\\s+" + C + "\\s*(?:[·•\\-–—]\\s*)?", "i");

    body = body.replace(re1, "").replace(re2, "").trim();
    return body;
  }

  // ✅ Desktop scroll hint logic (NEW)
  function updateScrollHint(){
    if(!lbScrollHint) return;

    if(isMobileNow() || !lb.classList.contains('open')){
      lbScrollHint.classList.remove('show');
      lbScrollHint.setAttribute('aria-hidden','true');
      return;
    }

    const canScroll = lb.scrollHeight > lb.clientHeight + 10;
    const atBottom = lb.scrollTop >= (lb.scrollHeight - lb.clientHeight - 10);

    if(canScroll && !atBottom){
      lbScrollHint.classList.add('show');
      lbScrollHint.setAttribute('aria-hidden','false');
    } else {
      lbScrollHint.classList.remove('show');
      lbScrollHint.setAttribute('aria-hidden','true');
    }
  }

  function render(){
    if(!images.length) return;

    // ✅ single image: hide arrows (desktop + mobile)
    if(images.length <= 1){
      btnPrev.style.display = 'none';
      btnNext.style.display = 'none';
    } else {
      btnPrev.style.display = '';
      btnNext.style.display = '';
    }

    const src = images[index];
    const counter = `${index + 1}/${images.length}`;
    lbImg.alt = title ? `${title} (${counter})` : `Photo ${counter}`;

    lbImg.style.opacity = 0;

    preload(images[safeIndex(index)]);
    preload(images[safeIndex(index + 1)]);
    preload(images[safeIndex(index - 1)]);

    lockIfMobile();

    const tmp = new Image();
    tmp.decoding = "async";

    tmp.onload = () => {
      lbImg.src = src;
      requestAnimationFrame(() => { lbImg.style.opacity = 1; });
      unlock();
      updateScrollHint(); // NEW
    };

    tmp.onerror = () => {
      lbImg.src = src;
      requestAnimationFrame(() => { lbImg.style.opacity = 1; });
      unlock();
      updateScrollHint(); // NEW
    };

    tmp.src = src;

    // ✅ caption: keep top line "Title — 1/7", body removes duplicate prefix if it exists
    const bodyText = stripDupPrefixFromBody(caption, title, counter);

    // Desktop caption: keep your preferred format
    lbCaption.textContent = title
      ? `${title} — ${counter}${bodyText ? "\n\n" + bodyText : ""}`
      : counter;

    // Mobile sheet: title line only + body only
    if(capBody){
      capTitle.textContent = title ? `${title} — ${counter}` : counter;
      capBody.textContent = bodyText || "";
      capBody.scrollTop = 0;
      closeCaptionSheet();
    }

    // Ensure hint state correct (NEW)
    updateScrollHint();
  }

  function openLightbox(list, t, c){
    images = list;
    index = 0;
    title = t || '';
    caption = c || '';

    lb.classList.add('open');
    lb.setAttribute('aria-hidden','false');

    // ✅ lock page scroll (prevents Chrome “main page moves”)
    scrollY = window.scrollY || window.pageYOffset || 0;
    document.body.classList.add('lb-open');
    document.body.style.top = `-${scrollY}px`;

    render();
    updateScrollHint(); // NEW
  }

  function closeLightbox(){
    lb.classList.remove('open');
    lb.classList.remove('cap-open');
    lb.setAttribute('aria-hidden','true');

    // ✅ restore page scroll position
    document.body.classList.remove('lb-open');
    document.body.style.top = '';
    window.scrollTo(0, scrollY);

    unlock();
    updateScrollHint(); // NEW
  }

  function prev(){
    if(images.length <= 1) return;
    if(isMobileNow() && isSwitching) return;
    index = safeIndex(index - 1);
    render();
  }

  function next(){
    if(images.length <= 1) return;
    if(isMobileNow() && isSwitching) return;
    index = safeIndex(index + 1);
    render();
  }

  document.querySelectorAll('.album').forEach(card => {
    card.addEventListener('click', () => {
      const list = (card.dataset.images || '')
        .split(',')
        .map(s => s.trim())
        .filter(Boolean);

      if(!list.length) return;
      openLightbox(list, card.dataset.title, card.dataset.caption);
    });
  });

  btnClose.addEventListener('click', closeLightbox);
  btnPrev.addEventListener('click', prev);
  btnNext.addEventListener('click', next);

  lb.addEventListener('click', (e) => {
    if(e.target === lb) closeLightbox();
  });

  window.addEventListener('keydown', (e) => {
    if(!lb.classList.contains('open')) return;
    if(e.key === 'Escape') closeLightbox();
    if(e.key === 'ArrowLeft') prev();
    if(e.key === 'ArrowRight') next();
  });

  // ✅ keep hint in sync when scrolling / resizing (NEW)
  lb.addEventListener('scroll', updateScrollHint, { passive:true });
  window.addEventListener('resize', updateScrollHint);

  // caption sheet toggle + swipe
  if(capHandle && capSheet){
    capHandle.addEventListener('click', () => {
      if(!isMobileNow()) return;
      if(lb.classList.contains('cap-open')) closeCaptionSheet();
      else openCaptionSheet();
    });

    let capStartY = 0;
    let capDy = 0;
    let capTracking = false;

    capHandle.addEventListener('touchstart', (e) => {
      if(!isMobileNow()) return;
      if(!e.touches || e.touches.length !== 1) return;
      capStartY = e.touches[0].clientY;
      capDy = 0;
      capTracking = true;
    }, { passive:true });

    capHandle.addEventListener('touchmove', (e) => {
      if(!capTracking) return;
      if(!isMobileNow()) return;
      if(!e.touches || e.touches.length !== 1) return;
      capDy = e.touches[0].clientY - capStartY;
      if(Math.abs(capDy) > 6) e.preventDefault();
    }, { passive:false });

    capHandle.addEventListener('touchend', () => {
      if(!capTracking) return;
      capTracking = false;
      if(!isMobileNow()) return;

      if(capDy < -30) openCaptionSheet();
      else if(capDy > 30) closeCaptionSheet();
    }, { passive:true });
  }

  // swipe left/right for photos (mobile)
  let startX = 0, startY = 0;
  let tracking = false;
  let lockedDirection = null;
  const SWIPE_MIN = 45;
  const LOCK_THRESHOLD = 10;

  function onTouchStart(e){
    if(!lb.classList.contains('open')) return;
    if(!isMobileNow()) return;
    if(!e.touches || e.touches.length !== 1) return;

    const path = e.composedPath ? e.composedPath() : [];
    if(path.includes(capSheet)) return;

    const t = e.touches[0];
    startX = t.clientX;
    startY = t.clientY;
    tracking = true;
    lockedDirection = null;
  }

  function onTouchMove(e){
    if(!tracking) return;
    if(!lb.classList.contains('open')) return;
    if(!isMobileNow()) return;
    if(!e.touches || e.touches.length !== 1) return;

    const t = e.touches[0];
    const dx = t.clientX - startX;
    const dy = t.clientY - startY;

    if(!lockedDirection){
      if(Math.abs(dx) > LOCK_THRESHOLD || Math.abs(dy) > LOCK_THRESHOLD){
        lockedDirection = Math.abs(dx) > Math.abs(dy) ? "x" : "y";
      } else {
        return;
      }
    }

    if(lockedDirection === "x"){
      e.preventDefault();
    }
  }

  function onTouchEnd(e){
    if(!tracking) return;
    tracking = false;

    if(!lb.classList.contains('open')) return;
    if(!isMobileNow()) return;
    if(lockedDirection !== "x") return;

    const t = (e.changedTouches && e.changedTouches[0]) ? e.changedTouches[0] : null;
    if(!t) return;

    const dx = t.clientX - startX;
    const dy = t.clientY - startY;

    if(Math.abs(dx) < SWIPE_MIN) return;
    if(Math.abs(dx) < Math.abs(dy)) return;

    if(dx < 0) next();
    else prev();
  }

  lb.addEventListener('touchstart', onTouchStart, { passive: true });
  lb.addEventListener('touchmove', onTouchMove, { passive: false });
  lb.addEventListener('touchend', onTouchEnd, { passive: true });

  // double-tap image to close (mobile)
  let lastTap = 0;
  lbImg.addEventListener('touchend', () => {
    if(!lb.classList.contains('open')) return;
    if(!isMobileNow()) return;
    const now = Date.now();
    if(now - lastTap < 300) closeLightbox();
    lastTap = now;
  }, { passive: true });
</script>

</body>
</html>
