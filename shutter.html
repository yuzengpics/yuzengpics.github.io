<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Shutter – Yu Zeng Photography</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Playfair+Display:ital,wght@1,500&display=swap" rel="stylesheet">

<style>
*{ box-sizing:border-box; }
html, body{ height:100%; }

body{
  margin:0;
  font-family: Arial, sans-serif;
  background:#e9edf2;
  color:#111;
}

/* ✅ Strong scroll lock */
body.lb-open{
  position: fixed;
  left: 0;
  right: 0;
  width: 100%;
  overflow: hidden;
  overscroll-behavior: none;
}

/* ===== Navbar ===== */
.navbar{
  position:fixed;
  top:0; left:0; right:0;
  height:72px;
  background:rgba(10,20,35,0.94);
  backdrop-filter:blur(8px);
  -webkit-backdrop-filter:blur(8px);
  z-index:2000;
}

body.lb-open .navbar{
  backdrop-filter:none !important;
  -webkit-backdrop-filter:none !important;
}

.nav-inner{
  max-width:1200px;
  height:100%;
  margin:0 auto;
  padding:0 28px;
  display:flex;
  align-items:center;
  justify-content:space-between;
}

/* ===== Brand ===== */
.brand{
  display:flex;
  align-items:center;
  gap:14px;
  text-decoration:none;
}
.brand-logo{ height:48px; width:auto; }

.brand-text{ display:flex; flex-direction:column; line-height:1; }
.brand-name{
  font-family:"Montserrat",sans-serif;
  font-weight:700;
  font-size:17px;
  letter-spacing:1.6px;
  color:#fff;
}
.brand-sub{
  margin-top:4px;
  font-family:"Playfair Display",serif;
  font-style:italic;
  font-size:14px;
  color:rgba(255,255,255,0.8);
}

/* ===== Nav links ===== */
.nav-links{ display:flex; gap:34px; align-items:center; }
.nav-links a{
  color:rgba(255,255,255,0.85);
  text-decoration:none;
  font-size:16px;
  padding:6px 0;
  border-bottom:2px solid transparent;
  white-space:nowrap;
}
.nav-links a:hover{ color:#fff; }
.nav-links a.active{ color:#fff; border-bottom-color:#fff; }

/* ===== Hero ===== */
.hero{
  margin-top:72px;
  padding:110px 0 80px;
  text-align:center;
  color:#fff;
  background:
    linear-gradient(rgba(0,0,0,0.45),rgba(0,0,0,0.45)),
    url("photo_x/J_x.jpg") center/cover no-repeat;
}
.hero h1{ margin:0 0 10px; font-size:56px; }
.hero p{ margin:0; font-size:18px; opacity:.9; }

/* ===== Page container ===== */
main.page{
  max-width: 1100px;
  margin: 0 auto;
  padding: 28px 20px 80px;
}

/* ===== Masonry ===== */
.masonry{
  column-count: 3;
  column-gap: 16px;
}
@media (max-width: 950px){ .masonry{ column-count: 2; } }
@media (max-width: 650px){ .masonry{ column-count: 1; } }

.album{
  break-inside: avoid;
  margin-bottom: 16px;
  cursor: pointer;
}

.album img{
  width: 100%;
  display:block;
  border-radius: 12px;
  box-shadow: 0 10px 22px rgba(0,0,0,0.10);
  transition: transform .18s ease, box-shadow .18s ease;
}
.album:hover img{
  transform: translateY(-2px);
  box-shadow: 0 14px 30px rgba(0,0,0,0.14);
}
.album p{
  margin: 8px 0 0;
  text-align:center;
  font-size: 14px;
  color:#444;
}

/* ===== Lightbox ===== */
.lightbox{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.86);
  display: none;
  z-index: 3000;

  overflow-y: auto;
  -webkit-overflow-scrolling: touch;

  touch-action: pan-y;
  overscroll-behavior: contain;
}
.lightbox.open{ display:block; }

.lightbox .lb-stage{
  min-height: 100dvh;
  display:flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding-left: 16px;
  padding-right: 16px;
  padding-top: calc(env(safe-area-inset-top, 0px) + 64px);
  padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 18px);
}

.lightbox img{
  width: auto;
  max-width: 92vw;
  max-height: calc(100dvh - 210px);
  border-radius: 12px;
  box-shadow: 0 18px 40px rgba(0,0,0,0.35);
  display:block;
  object-fit: contain;
}

#lb-img{
  opacity: 0;
  transition: opacity .18s ease;
  will-change: opacity;
  -webkit-user-select: none;
  user-select: none;
  -webkit-touch-callout: none;
}
.lightbox.open #lb-img{ opacity: 1; }

/* Desktop caption */
.lb-caption-desktop{
  color:#fff;
  margin-top: 12px;
  text-align:center;
  max-width: 920px;
  line-height: 1.55;
  font-size: 15px;
  opacity: 0.95;

  max-height: 22vh;
  overflow: auto;
  padding: 0 10px 10px;
  white-space: pre-line; 
}

/* Mobile caption drawer */
.lb-sheet{ display:none; }

/* Buttons */
.lb-close, .lb-prev, .lb-next{
  position: absolute;
  background: rgba(255,255,255,0.12);
  border: 1px solid rgba(255,255,255,0.25);
  color: #fff;
  width: 44px;
  height: 44px;
  border-radius: 999px;
  font-size: 26px;
  line-height: 40px;
  cursor: pointer;
  user-select: none;
}

.lb-close{
  position: fixed;
  top: calc(env(safe-area-inset-top, 0px) + 12px);
  right: calc(env(safe-area-inset-right, 0px) + 12px);
  z-index: 5000;
  font-size: 30px;
  line-height: 38px;
  background: rgba(0,0,0,0.55);
  border-color: rgba(255,255,255,0.22);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  pointer-events: auto;
}

.lb-prev{ left: 18px; top: 50%; transform: translateY(-50%); }
.lb-next{ right: 18px; top: 50%; transform: translateY(-50%); }

.lb-prev[disabled], .lb-next[disabled]{
  opacity: .45;
  cursor: not-allowed;
}

/* ===== Mobile: caption sheet (tap/swipe open) ===== */
@media (max-width:700px){
  .navbar{ height:64px; }
  .nav-inner{ padding:0 18px; }
  .brand-logo{ height:28px; }

  .nav-links{
    gap:16px;
    overflow-x:auto;
    max-width:70vw;
    scrollbar-width:none;
    flex-wrap: nowrap;
  }
  .nav-links::-webkit-scrollbar{ display:none; }
  .nav-links a{ font-size:13px; }

  .hero{ margin-top:64px; padding:90px 0 60px; }
  .hero h1{ font-size:40px; }
  .hero p{ font-size:16px; }

  .lightbox img{ max-height: calc(100dvh - 260px); }

  .lb-caption-desktop{ display:none; }

  .lb-sheet{
    display:block;
    position: fixed;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 3500;

    max-height: 72dvh;

    background: rgba(0,0,0,0.70);
    border-top: 1px solid rgba(255,255,255,0.16);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);

    transform: translateY(calc(100% - 74px));
    transition: transform .22s ease;
    will-change: transform;

    display:flex;
    flex-direction: column;

    padding-bottom: env(safe-area-inset-bottom, 0px);
  }

  .lightbox.cap-open .lb-sheet{
    transform: translateY(0);
  }

  .lb-grab{
    height: 74px;
    padding: 10px 14px 8px;
    display:flex;
    flex-direction: column;
    justify-content: center;
    gap: 8px;
    user-select:none;
    -webkit-user-select:none;
  }

  .lb-grab::before{
    content:"";
    width: 46px;
    height: 4px;
    border-radius: 999px;
    background: rgba(255,255,255,0.35);
    margin: 0 auto;
  }

  /* ✅ top line in sheet */
  .lb-sheet-title{
    color:#fff;
    font-size: 13px;
    opacity: .90;
    text-align:center;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* ✅ body only (no duplicated title) */
  .lb-sheet-body{
    padding: 0 16px 16px;
    overflow: auto;
    -webkit-overflow-scrolling: touch;

    color:#fff;
    text-align:center;
    line-height:1.55;
    font-size: 14px;
    opacity: .95;
    white-space: pre-line;
  }
}
</style>
</head>

<body>
<nav class="navbar">
  <div class="nav-inner">
    <a class="brand" href="index.html">
      <img src="photo_x/Logo.png" class="brand-logo" alt="Yu Zeng logo">
      <div class="brand-text">
        <span class="brand-name">Yu Zeng</span>
        <span class="brand-sub">Photography</span>
      </div>
    </a>
    <div class="nav-links">
      <a href="index.html">Home</a>
      <a href="memento.html">Memento</a>
      <a class="active" href="shutter.html">Shutter</a>
      <a href="sport.html">Sport</a>
      <a href="contact.html">Contact</a>
    </div>
  </div>
</nav>

<header class="hero">
  <h1>Shutter</h1>
  <p>Fragments, no theme, no rules. Just pieces of anything.</p>
</header>

<main class="page">
  <div class="masonry">

    <div class="album"
      data-title="Guinness"
      data-caption="Sexy drink."
      data-images="photo_x/DSC00755_x.jpg">
      <img src="photo_x/DSC00755_x.jpg" loading="lazy" decoding="async" alt="Guinness">
      <p>Guinness</p>
    </div>

    <div class="album"
      data-title="Towel"
      data-caption="Towel, Datong"
      data-images="photo_x/DSC03136_x.jpg">
      <img src="photo_x/DSC03136_x.jpg" loading="lazy" decoding="async" alt="Towel">
      <p>Towel</p>
    </div>

    <div class="album"
      data-title="Hedgehog"
      data-caption="Blueberry goat cheese"
      data-images="photo_x/DSC03868_x.jpg">
      <img src="photo_x/DSC03868_x.jpg" loading="lazy" decoding="async" alt="Hedgehog">
      <p>Hedgehog</p>
    </div>

    <div class="album"
      data-title="Pray"
      data-caption="Wutai mountain"
      data-images="photo_x/DSC03285_x.jpg">
      <img src="photo_x/DSC03285_x.jpg" loading="lazy" decoding="async" alt="Pray">
      <p>Pray</p>
    </div>

  </div>

  <div id="lightbox" class="lightbox" aria-hidden="true">
    <button class="lb-close" aria-label="Close">&times;</button>
    <button class="lb-prev" aria-label="Previous">&#8249;</button>
    <button class="lb-next" aria-label="Next">&#8250;</button>

    <div class="lb-stage">
      <img id="lb-img" src="" alt="" decoding="async" draggable="false">
      <div class="lb-caption-desktop" id="lb-caption"></div>
    </div>

    <!-- ✅ mobile caption drawer -->
    <div class="lb-sheet" id="lb-sheet" aria-hidden="true">
      <!-- ✅ IMPORTANT: must have id="lb-grab" so JS can bind -->
      <div class="lb-grab" id="lb-grab">
        <div class="lb-sheet-title" id="lb-sheet-title">Swipe up for caption</div>
      </div>
      <div class="lb-sheet-body" id="lb-sheet-body"></div>
    </div>
  </div>
</main>

<script>
  const lb = document.getElementById('lightbox');
  const lbImg = document.getElementById('lb-img');
  const lbCaptionDesktop = document.getElementById('lb-caption');

  const btnClose = document.querySelector('.lb-close');
  const btnPrev = document.querySelector('.lb-prev');
  const btnNext = document.querySelector('.lb-next');

  const lbSheet = document.getElementById('lb-sheet');
  const lbGrab = document.getElementById('lb-grab');
  const lbSheetTitle = document.getElementById('lb-sheet-title');
  const lbSheetBody = document.getElementById('lb-sheet-body');

  let images = [];
  let index = 0;
  let title = '';
  let caption = '';

  let isSwitching = false;
  let unlockTimer = null;

  // ✅ scroll-lock state
  let scrollY = 0;

  function isMobileNow(){
    return window.matchMedia("(max-width:700px)").matches;
  }

  function preload(src){
    if(!src) return;
    const im = new Image();
    im.decoding = "async";
    im.src = src;
  }

  function safeIndex(i){
    if(!images.length) return 0;
    return (i + images.length) % images.length;
  }

  function updateArrows(){
    const multi = images.length > 1;
    btnPrev.style.display = multi ? "" : "none";
    btnNext.style.display = multi ? "" : "none";
    btnPrev.disabled = !multi;
    btnNext.disabled = !multi;
  }

  function setNavDisabled(disabled){
    btnPrev.disabled = disabled;
    btnNext.disabled = disabled;
  }

  function lockIfMobile(){
    if(!isMobileNow()) return;

    isSwitching = true;
    setNavDisabled(true);

    if(unlockTimer) clearTimeout(unlockTimer);
    unlockTimer = setTimeout(() => {
      isSwitching = false;
      setNavDisabled(false);
      unlockTimer = null;
    }, 500);
  }

  function unlock(){
    if(unlockTimer){
      clearTimeout(unlockTimer);
      unlockTimer = null;
    }
    isSwitching = false;
    setNavDisabled(false);
  }

  function closeSheet(){
    lb.classList.remove('cap-open');
    if(lbSheet) lbSheet.setAttribute('aria-hidden','true');
  }

  function openSheet(){
    lb.classList.add('cap-open');
    if(lbSheet) lbSheet.setAttribute('aria-hidden','false');
  }

  function escapeRegExp(s){
    return String(s).replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
  }

  // ✅ Remove duplicate "Title — 1/7" ONLY if it appears at start of caption
  function stripDupPrefixFromBody(rawBody, t, counter){
    let body = (rawBody || "").trim();
    if(!body) return "";

    const tt = (t || "").trim();
    if(!tt) return body;

    const T = escapeRegExp(tt);
    const C = escapeRegExp(counter);

    const re1 = new RegExp("^\\s*" + T + "\\s*[—–-]\\s*" + C + "\\s*(?:[·•\\-–—]\\s*)?", "i");
    const re2 = new RegExp("^\\s*" + T + "\\s+" + C + "\\s*(?:[·•\\-–—]\\s*)?", "i");

    body = body.replace(re1, "").replace(re2, "").trim();
    return body;
  }

  function setCaptionText(){
    const counter = `${index + 1}/${images.length}`;
    const topLine = title ? `${title} — ${counter}` : counter;

    // Desktop: keep one block (title+counter + caption)
    const cleanBody = stripDupPrefixFromBody(caption, title, counter);
    const desktopText = title
      ? `${title} — ${counter}${cleanBody ? "\n\n" + cleanBody : ""}`
      : counter;

    lbCaptionDesktop.textContent = desktopText;

    // Mobile: top line in handle, body only (no duplicate title)
    if(lbSheetTitle) lbSheetTitle.textContent = topLine;
    if(lbSheetBody) lbSheetBody.textContent = cleanBody || "";
  }

  function render(){
    if(!images.length) return;

    updateArrows();

    const src = images[index];
    const counter = `${index + 1}/${images.length}`;
    lbImg.alt = title ? `${title} (${counter})` : `Photo ${counter}`;

    lbImg.style.opacity = 0;

    preload(images[safeIndex(index)]);
    preload(images[safeIndex(index + 1)]);
    preload(images[safeIndex(index - 1)]);

    lockIfMobile();

    const tmp = new Image();
    tmp.decoding = "async";

    tmp.onload = () => {
      lbImg.src = src;
      requestAnimationFrame(() => { lbImg.style.opacity = 1; });
      unlock();
    };

    tmp.onerror = () => {
      lbImg.src = src;
      requestAnimationFrame(() => { lbImg.style.opacity = 1; });
      unlock();
    };

    tmp.src = src;

    setCaptionText();
    closeSheet();     // default collapsed
    lb.scrollTop = 0;
  }

  function openLightbox(list, t, c){
    images = list;
    index = 0;
    title = t || '';
    caption = c || '';

    lb.classList.add('open');
    lb.setAttribute('aria-hidden','false');

    scrollY = window.scrollY || window.pageYOffset || 0;
    document.body.classList.add('lb-open');
    document.body.style.top = `-${scrollY}px`;

    lb.scrollTop = 0;
    closeSheet();
    render();
  }

  function closeLightbox(){
    lb.classList.remove('open');
    lb.setAttribute('aria-hidden','true');

    closeSheet();

    document.body.classList.remove('lb-open');
    document.body.style.top = '';
    window.scrollTo(0, scrollY);

    unlock();
  }

  function prev(){
    if(images.length <= 1) return;
    if(isMobileNow() && isSwitching) return;
    index = safeIndex(index - 1);
    render();
  }

  function next(){
    if(images.length <= 1) return;
    if(isMobileNow() && isSwitching) return;
    index = safeIndex(index + 1);
    render();
  }

  document.querySelectorAll('.album').forEach(card => {
    card.addEventListener('click', () => {
      const list = (card.dataset.images || '')
        .split(',')
        .map(s => s.trim())
        .filter(Boolean);

      if(!list.length) return;
      openLightbox(list, card.dataset.title, card.dataset.caption);
    });
  });

  btnClose.addEventListener('click', closeLightbox);
  btnPrev.addEventListener('click', prev);
  btnNext.addEventListener('click', next);

  lb.addEventListener('click', (e) => {
    if(e.target === lb) closeLightbox();
  });

  window.addEventListener('keydown', (e) => {
    if(!lb.classList.contains('open')) return;
    if(e.key === 'Escape') closeLightbox();
    if(images.length <= 1) return;
    if(e.key === 'ArrowLeft') prev();
    if(e.key === 'ArrowRight') next();
  });

  /* ===== Mobile caption sheet: tap + swipe handle ===== */
  if(lbGrab && lbSheet){
    lbGrab.addEventListener('click', () => {
      if(!isMobileNow()) return;
      if(lb.classList.contains('cap-open')) closeSheet();
      else openSheet();
    });

    let startY = 0;
    let dy = 0;
    let trackingSheet = false;

    lbGrab.addEventListener('touchstart', (e) => {
      if(!isMobileNow()) return;
      if(!e.touches || e.touches.length !== 1) return;
      startY = e.touches[0].clientY;
      dy = 0;
      trackingSheet = true;
    }, { passive:true });

    lbGrab.addEventListener('touchmove', (e) => {
      if(!trackingSheet) return;
      if(!isMobileNow()) return;
      if(!e.touches || e.touches.length !== 1) return;
      dy = e.touches[0].clientY - startY;
      if(Math.abs(dy) > 6) e.preventDefault();
    }, { passive:false });

    lbGrab.addEventListener('touchend', () => {
      if(!trackingSheet) return;
      trackingSheet = false;
      if(!isMobileNow()) return;

      if(dy < -30) openSheet();
      else if(dy > 30) closeSheet();
    }, { passive:true });
  }

  /* Swipe support (mobile) for photos */
  let startX = 0, startY = 0;
  let tracking = false;
  let lockedDirection = null;
  const SWIPE_MIN = 45;
  const LOCK_THRESHOLD = 10;

  function onTouchStart(e){
    if(!lb.classList.contains('open')) return;
    if(!e.touches || e.touches.length !== 1) return;

    const path = e.composedPath ? e.composedPath() : [];
    if(lbSheet && path.includes(lbSheet)) return;

    const t = e.touches[0];
    startX = t.clientX;
    startY = t.clientY;
    tracking = true;
    lockedDirection = null;
  }

  function onTouchMove(e){
    if(!tracking) return;
    if(!lb.classList.contains('open')) return;
    if(!e.touches || e.touches.length !== 1) return;

    const t = e.touches[0];
    const dx = t.clientX - startX;
    const dy = t.clientY - startY;

    if(!lockedDirection){
      if(Math.abs(dx) > LOCK_THRESHOLD || Math.abs(dy) > LOCK_THRESHOLD){
        lockedDirection = Math.abs(dx) > Math.abs(dy) ? "x" : "y";
      } else return;
    }

    if(lockedDirection === "x") e.preventDefault();
  }

  function onTouchEnd(e){
    if(!tracking) return;
    tracking = false;

    if(!lb.classList.contains('open')) return;
    if(lockedDirection !== "x") return;
    if(images.length <= 1) return;

    const t = (e.changedTouches && e.changedTouches[0]) ? e.changedTouches[0] : null;
    if(!t) return;

    const dx = t.clientX - startX;
    const dy = t.clientY - startY;

    if(Math.abs(dx) < SWIPE_MIN) return;
    if(Math.abs(dx) < Math.abs(dy)) return;

    if(dx < 0) next();
    else prev();
  }

  lb.addEventListener('touchstart', onTouchStart, { passive: true });
  lb.addEventListener('touchmove', onTouchMove, { passive: false });
  lb.addEventListener('touchend', onTouchEnd, { passive: true });
</script>
</body>
</html>
